function getCurrentFrame(e){var t=document.createElement("canvas");t.height=e.videoHeight,t.width=e.videoWidth;var n=t.getContext("2d");return n.drawImage(e,0,0,t.width,t.height),t.toDataURL("image/jpeg")}const TOTAL_PAGES=CONFIG.TOTAL_PAGES,IMAGE_PATH=CONFIG.IMAGE_PATH,ALIVE_PAGES=CONFIG.ALIVE_PAGES,IMAGE_EXTENSION=CONFIG.IMAGE_EXTENSION;var Page=function(){var e={$bookBlock:$("#bb-bookblock"),$navNext:$("#bb-nav-next"),$navPrev:$("#bb-nav-prev"),$navFirst:$("#bb-nav-first"),$navLast:$("#bb-nav-last"),$totalCount:$("#total-count"),$currentPage:$("#current-page")},t=function(){var t=window.innerWidth>0?window.innerWidth:screen.width,a=t<=768?"spinner-border-sm":"",i=Array.from({length:TOTAL_PAGES},()=>'<div class="bb-item"><figure class="d-flex"><span class="spinner-border '+a+' text-primary mx-auto my-auto"></span></figure></div>');$("#book-cover-front").closest(".bb-item").after(i),r(),n();var c,l,u=e.$bookBlock.bookblock($.extend({},BB_CONFIG,{onEndFlip:(c={},l=$("#bb-bookblock").children(".bb-item"),function(e,t,n){var r=Math.max(this.startPage,e-Math.floor(ALIVE_PAGES/2)),o=Math.min(TOTAL_PAGES,r+ALIVE_PAGES-1),a=Math.max(this.startPage,t-Math.floor(ALIVE_PAGES/2)),i=Math.min(TOTAL_PAGES,a+ALIVE_PAGES-1);for(let e=r;e<=o;e++){if(e>=a&&e<=i)continue;let t=$(l[e]);t.find("span.spinner-border").show(),t.find("img").remove(),e in c&&(c[e].src="",c[e].onload=null,delete c[e])}for(let e=a;e<=i;e++){if(e>=r&&e<=o)continue;let t=$(l[e]),n=new Image;n.src=IMAGE_PATH+e+IMAGE_EXTENSION,c[e]=n,n.onload=function(){t.children("figure").append('<img class="p-1" src='+n.src+" alt="+e+" />"),t.find("span.spinner-border").hide()}}if(0===t){let e=$("#book-cover-front > video"),t=e[0];e.attr("autoplay","true"),t.play()}}),onBeforeFlip:function(e,t){if(t>e&&0===e){let e=$("#book-cover-front > video"),t=e[0];t.pause();let n=getCurrentFrame(t);e.attr("poster",n),e.removeAttr("autoplay")}else if(t<e&&0===t){let e=$("#book-cover-front > video"),t=e[0];t.currentTime=0,e.removeAttr("poster")}}}));o(u)},n=function(){var t=e.$bookBlock.children(".bb-item");for(let e=1;e<=ALIVE_PAGES;e++){let n=new Image;n.src=IMAGE_PATH+e+IMAGE_EXTENSION,n.onload=function(){let r=$(t[e]);r.find("span.spinner-border").hide(),r.children("figure").append('<img class="p-1" src='+n.src+" alt="+e+" />")}}},r=function(){e.$totalCount.html(TOTAL_PAGES+1)},o=function(t){function n(n,...r){var o=$.data(t[0],"bookblock");if(o.isActive())return!1;e.$bookBlock.bookblock(n,...r);var a=parseInt(e.$currentPage.attr("value"));switch(n){case"next":a=Math.min(TOTAL_PAGES+1,a+1);break;case"prev":a=Math.max(0,a-1);break;case"first":a=0;break;case"last":a=TOTAL_PAGES+1;break;case"jump":a=e.$currentPage.val()}e.$currentPage.attr("value",a),e.$currentPage.val(a)}var r=e.$bookBlock.children();e.$navNext.on("click touchstart",function(){return n("next"),!1}),e.$navPrev.on("click touchstart",function(){return n("prev"),!1}),e.$navFirst.on("click touchstart",function(){return n("first"),!1}),e.$navLast.on("click touchstart",function(){return n("last"),!1}),r.on({swipeleft:function(e){return n("next"),!1},swiperight:function(e){return n("prev"),!1}}),$(document).keydown(function(t){var r=t.keyCode||t.which,o={left:37,up:38,right:39,down:40};t.keyCode>=48&&t.keyCode<=57||t.keyCode>=96&&t.keyCode<=105?document.activeElement!=e.$currentPage[0]&&(e.$currentPage.val(""),e.$currentPage.focus()):r===o.left?document.activeElement!=e.$currentPage[0]&&n("prev"):r===o.right&&document.activeElement!=e.$currentPage[0]&&n("next")}),e.$currentPage.keydown(function(e){if(13===e.keyCode){let t=parseInt(e.target.value);t>=0&&t<=TOTAL_PAGES+1&&(n("jump",t+1),this.blur())}})};return{init:t}}();$(function(){document.getElementById("flipbook").focus();var e=$("#book-cover-front > video")[0];e.muted=!0;var t=e.play();void 0!==t&&t.then(e=>{}).catch(t=>{e.setAttribute("controlsList","nofullscreen nodownload disablePictureInPicture"),e.setAttribute("controls","controls")}),Page.init()});