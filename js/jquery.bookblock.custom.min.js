(function(t,i,s){"use strict";var e=t(i),o=i.Modernizr;o.addTest("csstransformspreserve3d",function(){var t,s=o.prefixed("transformStyle"),e="preserve-3d";return!!s&&(s=s.replace(/([A-Z])/g,function(t,i){return"-"+i.toLowerCase()}).replace(/^ms-/,"-ms-"),o.testStyles("#modernizr{"+s+":"+e+";}",function(e,o){t=i.getComputedStyle?getComputedStyle(e,null).getPropertyValue(s):""}),t===e)});var n,r,a=t.event;n=a.special.debouncedresize={setup:function(){t(this).on("resize",n.handler)},teardown:function(){t(this).off("resize",n.handler)},handler:function(t,i){var s=this,e=arguments,o=function(){t.type="debouncedresize",a.dispatch.apply(s,e)};r&&clearTimeout(r),i?o():r=setTimeout(o,n.threshold)},threshold:150},t.BookBlock=function(i,s){this.$el=t(s),this._init(i)},t.BookBlock.defaults={startPage:1,orientation:"vertical",direction:"ltr",speed:1e3,easing:"ease-in-out",shadows:!0,shadowSides:.2,shadowFlip:.1,circular:!1,nextEl:"",prevEl:"",autoplay:!1,interval:3e3,onEndFlip:function(t,i,s){return!1},onBeforeFlip:function(t,i){return!1}},t.BookBlock.prototype={_init:function(i){this.options=t.extend(!0,{},t.BookBlock.defaults,i),this.$el.addClass("bb-"+this.options.orientation),this.$items=this.$el.children(".bb-item").hide(),this.itemsCount=this.$items.length,this.options.startPage>0&&this.options.startPage<=this.itemsCount?this.current=this.options.startPage-1:(h("startPage option is out of range"),this.current=0),this.previous=-1,this.$current=this.$items.eq(this.current).show(),this.elWidth=this.$el.width();var s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};this.transEndEventName=s[o.prefixed("transition")]+".bookblock",this.support=o.csstransitions&&o.csstransforms3d&&o.csstransformspreserve3d,this._initEvents(),this.options.autoplay&&(this.options.circular=!0,this._startSlideshow())},_initEvents:function(){var i=this;""!==this.options.nextEl&&t(this.options.nextEl).on("click.bookblock touchstart.bookblock",function(){return i._action("next"),!1}),""!==this.options.prevEl&&t(this.options.prevEl).on("click.bookblock touchstart.bookblock",function(){return i._action("prev"),!1}),e.on("debouncedresize",function(){i.elWidth=i.$el.width()})},_action:function(t,i){this._stopSlideshow(),this._navigate(t,i)},_navigate:function(t,i){if(this.isAnimating)return!1;var e;if(e=this.support?this._moveCoverBeforeFlip(this.current,t,this.itemsCount):Promise.resolve(),this.isAnimating=!0,this.$current=this.$items.eq(this.current),i!==s?(this.previous=this.current,this.current=i):"next"===t&&"ltr"===this.options.direction||"prev"===t&&"rtl"===this.options.direction?this.options.circular||this.current!==this.itemsCount-1?(this.previous=this.current,this.current=this.current<this.itemsCount-1?this.current+1:0):this.end=!0:("prev"===t&&"ltr"===this.options.direction||"next"===t&&"rtl"===this.options.direction)&&(this.options.circular||0!==this.current?(this.previous=this.current,this.current=this.current>0?this.current-1:this.itemsCount-1):this.end=!0),this.end)return this.isAnimating=!1,void(this.end=!1);this.$nextItem=!this.options.circular&&this.end?this.$current:this.$items.eq(this.current);var o=this;e.then(()=>{this.options.onBeforeFlip(this.previous,this.current),o.support?o._layout(t):o._layoutNoSupport(t)})},_layoutNoSupport:function(t){this.$items.hide(),this.$nextItem.show(),this.end=!1,this.isAnimating=!1;var i="next"===t&&this.current===this.itemsCount-1||"prev"===t&&0===this.current;this.options.onEndFlip(this.previous,this.current,t,this.itemsCount,i)},_layout:function(i){var s=this,e=this._addSide("left",i),o=this._addSide("middle",i),n=this._addSide("right",i),r=e.find("div.bb-overlay"),a=o.find("div.bb-flipoverlay:first"),h=o.find("div.bb-flipoverlay:last"),c=n.find("div.bb-overlay"),d=this.end?400:this.options.speed;if(this.$items.hide(),this.$el.prepend(e,o,n),o.css({transitionDuration:d+"ms",transitionTimingFunction:this.options.easing}).on(this.transEndEventName,function(e){if(t(e.target).hasClass("bb-page")){s.$nextItem.show();var o=s._moveCoverAfterFlip(s.end,s.current,i,s.itemsCount);o.then(()=>{s.$el.children(".bb-page").remove();var t="next"===i&&s.current===s.itemsCount-1||"prev"===i&&0===s.current;s.options.onEndFlip(s.previous,s.current,t),s.end=!1,s.isAnimating=!1})}}),"prev"===i&&o.addClass("bb-flip-initial"),this.options.shadows&&!this.end){var l="next"===i?{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms"}:{transition:"opacity "+this.options.speed/2+"ms linear",opacity:this.options.shadowSides},p="next"===i?{transition:"opacity "+this.options.speed/2+"ms linear"}:{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms",opacity:this.options.shadowFlip},u="next"===i?{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms",opacity:this.options.shadowFlip}:{transition:"opacity "+this.options.speed/2+"ms linear"},v="next"===i?{transition:"opacity "+this.options.speed/2+"ms linear",opacity:this.options.shadowSides}:{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms"};a.css(p),h.css(u),r.css(l),c.css(v)}setTimeout(function(){o.addClass(s.end?"bb-flip-"+i+"-end":"bb-flip-"+i),s.options.shadows&&!s.end&&(a.css({opacity:"next"===i?s.options.shadowFlip:0}),h.css({opacity:"next"===i?0:s.options.shadowFlip}),r.css({opacity:"next"===i?s.options.shadowSides:0}),c.css({opacity:"next"===i?0:s.options.shadowSides}))},25)},_addSide:function(i,s){var e;switch(i){case"left":e=t('<div class="bb-page"><div class="bb-back"><div class="bb-outer"><div class="bb-content"><div class="bb-inner">'+("next"===s?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",102);break;case"middle":e=t('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content"><div class="bb-inner">'+("next"===s?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-flipoverlay"></div></div></div><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===s?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-flipoverlay"></div></div></div></div>').css("z-index",103),"next"===s?(e.children(".bb-back").css("backface-visibility","visible"),e.children(".bb-back").children().css("backface-visibility","visible"),e.children(".bb-front").css("z-index",104)):(e.children(".bb-front").css("backface-visibility","visible"),e.children(".bb-front").children().css("backface-visibility","visible"),e.children(".bb-back").css("z-index",104));break;case"right":e=t('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content"><div class="bb-inner">'+("next"===s?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",101)}return e},_startSlideshow:function(){var t=this;this.slideshow=setTimeout(function(){t._navigate("next"),t.options.autoplay&&t._startSlideshow()},this.options.interval)},_stopSlideshow:function(){this.options.autoplay&&(clearTimeout(this.slideshow),this.options.autoplay=!1)},_moveCoverBeforeFlip:function(i,s,e){if("next"===s&&0===i){var o=t("#book-cover-front > *");return o.addClass("move-book-cover"),this._transitionToPromise(o)}if("prev"===s&&i===e-1){o=t("#book-cover-back > *");return o.removeClass("move-book-cover"),this._transitionToPromise(o)}return Promise.resolve()},_moveCoverAfterFlip:function(i,s,e,o){if(i||"prev"!==e||0!==s){if(i||"next"!==e||s!==o-1)return Promise.resolve();n=t("#book-cover-back > *");return n.addClass("move-book-cover"),this._transitionToPromise(n)}var n=t("#book-cover-front > *");return n.removeClass("move-book-cover"),this._transitionToPromise(n)},_transitionToPromise:function(t){return new Promise(i=>{const s=e=>{t.off(this.transEndEventName,s),i()};t.on(this.transEndEventName,s)})},next:function(){this._action("ltr"===this.options.direction?"next":"prev")},prev:function(){this._action("ltr"===this.options.direction?"prev":"next")},jump:function(t){if(t-=1,t===this.current||t>=this.itemsCount||t<0)return!1;var i;i="ltr"===this.options.direction?t>this.current?"next":"prev":t>this.current?"prev":"next",this._action(i,t)},last:function(){this.jump(this.itemsCount)},first:function(){this.jump(1)},isActive:function(){return this.isAnimating},update:function(){var t=this.$items.eq(this.current);this.$items=this.$el.children(".bb-item"),this.itemsCount=this.$items.length,this.current=t.index()},destroy:function(){this.options.autoplay&&this._stopSlideshow(),this.$el.removeClass("bb-"+this.options.orientation),this.$items.show(),""!==this.options.nextEl&&t(this.options.nextEl).off(".bookblock"),""!==this.options.prevEl&&t(this.options.prevEl).off(".bookblock"),e.off("debouncedresize")}};var h=function(t){i.console&&i.console.error(t)};t.fn.bookblock=function(i){if("string"==typeof i){var s=Array.prototype.slice.call(arguments,1);this.each(function(){var e=t.data(this,"bookblock");e?t.isFunction(e[i])&&"_"!==i.charAt(0)?e[i].apply(e,s):h("no such method '"+i+"' for bookblock instance"):h("cannot call methods on bookblock prior to initialization; attempted to call method '"+i+"'")})}else this.each(function(){var s=t.data(this,"bookblock");s?s._init():s=t.data(this,"bookblock",new t.BookBlock(i,this))});return this}})(jQuery,window);